@page "/user"
@using ASMC6.Client.Session
@using ASMC6.Shared
@inject HttpClient httpClient
@inject LocalStorageService _localStorageService
@inject NavigationManager Navigation

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
</head>
<body>
    @if(user is null)
    {
        <p>Loading...</p>
    }
    else
    {
        <div class="container">
            <div class="profile mb-5">
                <img class="avatar-icon"
                     loading="lazy"
                     alt=""
                     src="./public/avatar.svg" />

                <div class="greeting">
                    <div class="user-name">
                        <img class="link-icon" alt="" src="./public/link.svg" />
                        <a class="welcome-back">Welcome back,</a>
                        <b class="namegmailcom">@user.Email</b>
                    </div>
                </div>
            </div>

            <div class="col-md-12 row">
                <div class="col-md-3">
                    <table class="table border border-1">
                        <thead>
                            <tr>
                                <td>Thông tin người dùng</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a class="nav-link" href="/history">Lịch sử mua hàng</a></td>
                            </tr>
                            <tr>
                                <td>Chỉnh sửa tài khoản</td>
                            </tr>
                            <tr>
                                <td>Đổi mật khẩu</td>
                            </tr>
                            <tr>
                                <td>Ví mua sắm</td>
                            </tr>
                            <tr>
                                <td>Đổi tải khoản</td>
                            </tr>
                            <tr>
                                <td><a class="nav-link" @onclick="Logout" href="/login">Đăng xuất</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-9">
                    <h3>Tài khoản của tôi</h3>
                    <div>
                        <label for="Name" class="mt-2"><p>Họ và tên</p></label>
                        <div>
                            <input type="text" value="@user.Name" class="form-control" />
                        </div>
                    </div>
                    <div>
                        <label for="Name" class="mt-2"><p>Địa chỉ</p></label>
                        <div>
                            <input type="text" value="@user.Address" class="form-control" />
                        </div>
                    </div>
                    <div>
                        <label for="Name" class="mt-2"><p>Tên cửa hàng (nếu đã đăng ký)</p></label>
                        <div>
                            <input type="text" class="form-control" />
                        </div>
                    </div>
                    <div>
                        <label for="Name" class="mt-2"><p>Email</p></label>
                        <div>
                            <input type="text" value="@user.Email" class="form-control" />
                        </div>
                    </div>
                    <div>
                        <label for="Name" class="mt-2"><p>Số điện thoại</p></label>
                        <div>
                            <input type="text" value="@user.Phone" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

</body>

@code{
    private List<User> listUser;
    private User user = new User();
    protected override async Task OnInitializedAsync()
    {
        var email = await _localStorageService.GetItemAsync("userName");

        if (email is null)
        {
            Navigation.NavigateTo("/login");
        }

        listUser = await httpClient.GetFromJsonAsync<List<User>>("api/User/GetUsers");

        if (listUser != null)
        {
            user = listUser.FirstOrDefault(u => u.Email.Equals(email));
        }
        
    }
    private void Logout(){
        Navigation.NavigateTo("/logout");
    }
}